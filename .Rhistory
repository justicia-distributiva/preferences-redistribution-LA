lapop$year_2018[lapop$year==2018] = 1
#Countries
countries = c("ARG",
"BOL",
"BRA",
"CHL",
"COL",
"CRI",
"DOM",
"ECU",
"GTM",
"HND",
"MEX",
"NIC",
"PAN",
"PER",
"PRY",
"SLV",
"URY",
"VEN")
#GINI
for (i in 1:length(countries)) {
name=paste0("gini_", countries[i])
pais= paste0(countries[i])
assign(name, wb(indicator = "SI.POV.GINI", country = pais, startdate = 2005, enddate = 2019))
}
gini= rbind(gini_ARG,
gini_BOL,
gini_BRA,
gini_CHL,
gini_COL,
gini_CRI,
gini_DOM,
gini_ECU,
gini_GTM,
gini_HND,
gini_MEX,
gini_NIC,
gini_PAN,
gini_PER,
gini_PRY,
gini_SLV,
gini_URY,
gini_VEN)
gini$id= NA
gini$id= paste0(gini$iso3c,"_",gini$date)
gini= gini[,c(8,1,2,3,4,5,6,7)]
gini= gini[,c(1,4)]
names(gini)[2]= "gini"
#GDP per capita
for (i in 1:length(countries)) {
name=paste0("gdp_", countries[i])
pais= paste0(countries[i])
assign(name, wb(indicator = "NY.GDP.PCAP.KD", country = pais, startdate = 2005, enddate = 2019))
}
gdp= rbind(gdp_ARG,
gdp_BOL,
gdp_BRA,
gdp_CHL,
gdp_COL,
gdp_CRI,
gdp_DOM,
gdp_ECU,
gdp_GTM,
gdp_HND,
gdp_MEX,
gdp_NIC,
gdp_PAN,
gdp_PER,
gdp_PRY,
gdp_SLV,
gdp_URY,
gdp_VEN)
gdp$id= NA
gdp$id= paste0(gdp$iso3c,"_",gdp$date)
gdp= gdp[,c(8,1,2,3,4,5,6,7)]
gdp= gdp[,c(1,4)]
names(gdp)[2]= "gdp"
#Thousands of dollars
gdp$gdp = (gdp$gdp)/1000
#Fusion of country variables databases
country_vars = full_join(gini, gdp) %>%
arrange(desc(id))
#Original databases
country_vars_original = country_vars
lapop_original = lapop
#Reallocation of data in missings
country_vars$gini[country_vars$id=="ARG_2018"] = country_vars$gini[country_vars$id=="ARG_2017"]
country_vars$gini[country_vars$id=="BOL_2010"] = country_vars$gini[country_vars$id=="BOL_2009"]
country_vars$gini[country_vars$id=="BOL_2018"] = country_vars$gini[country_vars$id=="BOL_2017"]
country_vars$gini[country_vars$id=="BRA_2010"] = country_vars$gini[country_vars$id=="BRA_2009"]
country_vars$gini[country_vars$id=="BRA_2018"] = country_vars$gini[country_vars$id=="BRA_2017"]
country_vars$gini[country_vars$id=="CHL_2008"] = country_vars$gini[country_vars$id=="CHL_2009"]
country_vars$gini[country_vars$id=="CHL_2010"] = country_vars$gini[country_vars$id=="CHL_2009"]
country_vars$gini[country_vars$id=="CHL_2012"] = country_vars$gini[country_vars$id=="CHL_2011"]
country_vars$gini[country_vars$id=="CHL_2014"] = country_vars$gini[country_vars$id=="CHL_2013"]
country_vars$gini[country_vars$id=="CHL_2016"] = country_vars$gini[country_vars$id=="CHL_2015"]
country_vars$gini[country_vars$id=="CHL_2018"] = country_vars$gini[country_vars$id=="CHL_2017"]
country_vars$gini[country_vars$id=="COL_2018"] = country_vars$gini[country_vars$id=="COL_2017"]
country_vars$gini[country_vars$id=="CRI_2018"] = country_vars$gini[country_vars$id=="CRI_2017"]
country_vars$gini[country_vars$id=="DOM_2018"] = country_vars$gini[country_vars$id=="DOM_2016"] #DOM_2018
country_vars$gini[country_vars$id=="ECU_2018"] = country_vars$gini[country_vars$id=="ECU_2017"]
country_vars$gini[country_vars$id=="HND_2018"] = country_vars$gini[country_vars$id=="HND_2017"]
country_vars$gini[country_vars$id=="MEX_2018"] = country_vars$gini[country_vars$id=="MEX_2016"] #MEX_2018
country_vars$gini[country_vars$id=="PAN_2018"] = country_vars$gini[country_vars$id=="PAN_2017"]
country_vars$gini[country_vars$id=="PER_2018"] = country_vars$gini[country_vars$id=="PER_2017"]
country_vars$gini[country_vars$id=="PRY_2018"] = country_vars$gini[country_vars$id=="PRY_2017"]
country_vars$gini[country_vars$id=="SLV_2018"] = country_vars$gini[country_vars$id=="SLV_2017"]
country_vars$gini[country_vars$id=="URY_2018"] = country_vars$gini[country_vars$id=="URY_2017"]
#ECLAC
country_vars$gini[country_vars$id=="GTM_2006"] = 55.8
country_vars$gini[country_vars$id=="GTM_2014"] = 53.5
country_vars$gini[country_vars$id=="NIC_2009"] = 46.3
country_vars$gini[country_vars$id=="NIC_2014"] = 49.5
country_vars$gini[country_vars$id=="VEN_2008"] = 37.9
country_vars$gini[country_vars$id=="VEN_2010"] = 36.4
country_vars$gini[country_vars$id=="VEN_2012"] = 38.4
country_vars$gini[country_vars$id=="VEN_2014"] = 37.8
#Linear interpolation
country_vars$country_wave1 = country_vars$id
country_vars1 = country_vars %>%
separate(country_wave1, c("country", "year"))
#GTM
country_vars_GTM = country_vars1 %>%
filter(country=="GTM" & year>=2006 & year<=2014) %>%
mutate(gini=na.approx(gini))
#NIC
country_vars_NIC = country_vars1 %>%
filter(country=="NIC" & year>=2009 & year<=2014) %>%
mutate(gini=na.approx(gini))
#VEN
country_vars_VEN = country_vars1 %>%
filter(country=="VEN" & year<=2014)
#Rbind
country_vars_else = country_vars1 %>%
filter(country!="GTM") %>%
filter(country!="NIC") %>%
filter(country!="VEN")
country_vars = rbind(country_vars_else, country_vars_GTM, country_vars_NIC, country_vars_VEN) %>%
rename(country_wave = id) %>%
mutate(year = as.numeric(year)) %>%
arrange(desc(country_wave))
rm(list=setdiff(ls(), c("lapop", "country_vars", "lapop_original", "country_vars_original", "gini", "gdp")))
#Waves
country_vars_waves = filter(country_vars, year==2008 | year==2010 | year==2012 | year==2014 | year==2016 | year==2018)
#Means
country_vars_waves = country_vars_waves %>%
group_by(country) %>%
mutate(gini_mean = mean(gini, na.rm = T),
gdp_mean = mean(gdp, na.rm = T)) %>%
ungroup()
#Differences
country_vars_waves = country_vars_waves %>%
mutate(gini_dif = gini - gini_mean,
gdp_dif = gdp - gdp_mean)
#Welfare state
country_vars_waves = country_vars_waves %>%
mutate(welfare = case_when(
(country == "BRA" | country == "CRI" | country == "PAN" | country == "MEX" | country == "URY") ~ "Proteccionist",
(country == "ARG" | country == "CHL") ~ "Productivist",
TRUE ~"informal-familialist"))
#Merge Level-1 & Lvele-2 variables
country_vars_waves = country_vars_waves %>%
select(country, year, country_wave, gini, gdp,
gini_mean, gdp_mean, gini_dif, gdp_dif, welfare)
lapop = lapop %>%
left_join(country_vars_waves)
#Generate year_rec & country_wave_rec
lapop = lapop %>%
mutate(year_rec = case_when(year == 2008 ~ "08",
year == 2010 ~ "10",
year == 2012 ~ "12",
year == 2014 ~ "14",
year == 2016 ~ "16",
year == 2018 ~ "18"),
country_wave_rec = paste0(country, sep ="_", year_rec))
#Country and year as factor
lapop = lapop %>%
mutate(country = as.factor(country),
year = as.factor(year))
#Only cases with Level-2 variables
lapop_all = lapop
lapop = lapop %>%
filter_at(vars(gini:welfare), all_vars(!is.na(.)))
#Save Databases paper
rm(list=setdiff(ls(), c("lapop", "lapop_all", "country_vars_waves")))
#Save final database
save.image(here("Input", "Proc", "LAPOP_Final.RData"))
#Detach package conflicted
detach("package:conflicted", unload = TRUE)
#Install and load packages
pacman::p_load(tidyverse, countrycode, car, zoo, wbstats, Hmisc, stargazer, stats,
ggthemes, data.table, reshape2, scales, xtable, ggrepel, here, conflicted)
#Packages conflicts
conflict_prefer("select", "dplyr")
conflict_prefer("filter", "dplyr")
#Load database
rm(list = ls())
load(here("Input", "Proc", "LAPOP_Final.RData"))
#New
lapop = lapop %>%
select(country, countryname, country_wave, country_wave_rec,
year, wave, weight1500, wt, redistribution,
male_f, age, married_f, ideology_f, employment_r, education_r,
decile, decile_d10, decile_f, zone, sysconf,
gdp, gdp_mean, gdp_dif, gini, gini_mean, gini_dif, welfare)
#Level 1
lapop_a = lapop %>%
select(redistribution, decile, male_f, age,
married_f, ideology_f, sysconf, employment_r,
education_r, zone, decile_d10, decile_f)
lapop_a = lapop_a %>%
rename(income = decile) %>%
mutate(male = as.numeric(male_f) - 1,
married = as.numeric(married_f) - 1,
ideology = as.numeric(ideology_f) - 1,
urban = as.numeric(zone) - 1,
employment = as.numeric(employment_r) - 1,
education = as.numeric(education_r) - 1)
stargazer(as.data.frame(lapop_a), title="Descriptive Statistics", omit.summary.stat = c("p25", "p75"))
prop.table(table(lapop_a$male_f))
prop.table(table(lapop_a$married_f))
prop.table(table(lapop_a$employment_r))
prop.table(table(lapop_a$ideology_f))
prop.table(table(lapop_a$education_r))
prop.table(table(lapop_a$zone))
#Level 2
country_vars_waves_a= country_vars_waves %>%
select(-c(year, welfare))
stargazer(as.data.frame(country_vars_waves_a), title="Descriptive Statistics", omit.summary.stat = c("p25", "p75"))
#Level 3
country_vars = country_vars_waves %>%
distinct(country, .keep_all=TRUE) %>%
select(country, welfare)
prop.table(table(country_vars$welfare))
#Figure 2: Preference for redistribution by countries. Percentage by category.
redist = xtabs(~countryname+redistribution, data = lapop)
redist = prop.table(redist, 1)*100
redist = as.data.frame(redist) %>%
arrange(desc(redistribution, Freq)) %>%
mutate(countryname1 = case_when(countryname=="Bolivia" ~ 1,
countryname=="Peru" ~ 2,
countryname=="Guatemala" ~ 3,
countryname=="Ecuador" ~ 4,
countryname=="Honduras" ~ 5,
countryname=="El Salvador" ~ 6,
countryname=="Mexico" ~ 7,
countryname=="Colombia" ~ 8,
countryname=="Panama" ~  9,
countryname=="Brazil" ~ 10,
countryname=="Paraguay" ~ 11,
countryname=="Uruguay" ~ 12,
countryname=="Chile" ~ 13,
countryname=="Argentina" ~ 14,
countryname=="Costa Rica" ~ 15,
countryname=="Nicaragua" ~ 16,
countryname=="Dominican Republic" ~ 17)) %>%
mutate(countryname1 = factor(countryname1,
levels = c(1:17),
labels = c("Bolivia", "Peru", "Guatemala", "Ecuador", "Honduras", "El Salvador", "Mexico",
"Colombia", "Panama", "Brazil", "Paraguay", "Uruguay", "Chile", "Argentina",
"Costa Rica", "Nicaragua", "Dominican Republic")),
order = factor(countryname,
levels = c(1:17),
labels = c("Bolivia", "Peru", "Guatemala", "Ecuador", "Honduras", "El Salvador", "Mexico",
"Colombia", "Panama", "Brazil", "Paraguay", "Uruguay", "Chile", "Argentina",
"Costa Rica", "Nicaragua", "Dominican Republic")))
figure2 = ggplot(data = redist,
aes(x=reorder(countryname1, order), y = Freq,
fill = factor(redistribution))) +
geom_bar(stat = "identity", position = position_stack(reverse = TRUE)) + coord_flip() + labs(x = "", y = "", fill="") +
guides(fill = guide_legend(reverse = TRUE)) +
scale_y_continuous(labels = function(Freq){paste0(Freq, "%")}) +
theme(panel.background = element_rect(fill = "white"),
axis.text=element_text(size=10),
strip.text=element_text(size=12))  +
scale_fill_grey(start=0.8, end=0.2, name = "",
labels = c("1 (Disagree)", "2", "3", "4", "5", "6", "7 (Agree)"))
figure2
ggsave(here("Output", "Graphs", "Figure2.jpg"), plot=figure2, height = 4, units="in")
#Figure 3: Preference for redistribution by country and year
figure3 = ggplot(lapop, aes(x= redistribution,  colour= year)) +
geom_line(aes(y = ..prop.., fill = factor(..x..)), stat="count", binwidth = 1, size = 1) +
xlim(1, 7) +
facet_wrap(~countryname, ncol=3) +
labs(x = "Preference for redistribution", y = "", fill="") +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_x_continuous(breaks = c(1:7), labels = c("1 (Disagree)", "2", "3", "4", "5", "6", "7 (Agree)")) +
theme(
axis.text=element_text(size=15),
strip.text=element_text(size=15),
legend.text=element_text(size=15),
legend.title=element_text(size=15),
legend.key.size=unit(0.5,"cm"),
legend.position = "bottom",
panel.background = element_rect(fill = "white")) +
theme_hc() +
scale_color_grey(start=0.9, end=0.1, name="Wave")
figure3
#Figure 3: Preference for redistribution by country and year
figure3 = ggplot(lapop, aes(x= redistribution,  colour= year)) +
geom_line(aes(y = ..prop.., fill = factor(..x..)), stat="count", binwidth = 1, size = 1) +
xlim(1, 7) +
facet_wrap(~countryname, ncol=3) +
labs(x = "Preference for redistribution", y = "", fill="") +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_x_continuous(breaks = c(1:7), labels = c("1 (Disagree)", "2", "3", "4", "5", "6", "7 (Agree)")) +
theme(
axis.text=element_text(size=15),
strip.text=element_text(size=15),
legend.text=element_text(size=15),
legend.title=element_text(size=15),
legend.key.size=unit(0.5,"cm"),
legend.position = "bottom",
panel.background = element_rect(fill = "white")) +
theme_hc() +
scale_color_grey(start=0.9, end=0.1, name="Wave") +
scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
NULL
figure3
#Figure 3: Preference for redistribution by country and year
figure3 = ggplot(lapop, aes(x= redistribution,  colour= year)) +
geom_line(aes(y = ..prop.., fill = factor(..x..)), stat="count", binwidth = 1, size = 1) +
xlim(1, 7) +
facet_wrap(~countryname, ncol=3) +
labs(x = "Preference for redistribution", y = "", fill="") +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_x_continuous(breaks = c(1:7), labels = c("1 (Disagree)", "2", "3", "4", "5", "6", "7 (Agree)"),
guide = guide_axis(n.dodge = 2)) +
theme(
axis.text=element_text(size=15),
strip.text=element_text(size=15),
legend.text=element_text(size=15),
legend.title=element_text(size=15),
legend.key.size=unit(0.5,"cm"),
legend.position = "bottom",
panel.background = element_rect(fill = "white")) +
theme_hc() +
scale_color_grey(start=0.9, end=0.1, name="Wave")
figure3
#Figure 3: Preference for redistribution by country and year
figure3 = ggplot(lapop, aes(x= redistribution,  colour= year)) +
geom_line(aes(y = ..prop.., fill = factor(..x..)), stat="count", binwidth = 1, size = 1) +
xlim(1, 7) +
facet_wrap(~countryname, ncol=3) +
labs(x = "Preference for redistribution", y = "", fill="") +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_x_continuous(breaks = c(1:7), labels = c("1 (Disagree)", "2", "3", "4", "5", "6", "7 (Agree)")) +
theme(
axis.text=element_text(size=15),
strip.text=element_text(size=15),
legend.text=element_text(size=15),
legend.title=element_text(size=15),
legend.key.size=unit(0.5,"cm"),
legend.position = "bottom",
panel.background = element_rect(fill = "white"),
axis.text.x = element_text(angle = 45, hjust = 1)) +
theme_hc() +
scale_color_grey(start=0.9, end=0.1, name="Wave")
figure3
#Figure 3: Preference for redistribution by country and year
figure3 = ggplot(lapop, aes(x= redistribution,  colour= year)) +
geom_line(aes(y = ..prop.., fill = factor(..x..)), stat="count", binwidth = 1, size = 1) +
xlim(1, 7) +
facet_wrap(~countryname, ncol=3) +
labs(x = "Preference for redistribution", y = "", fill="") +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_x_continuous(breaks = c(1:7), labels = c("1 (Disagree)", "2", "3", "4", "5", "6", "7 (Agree)")) +
theme(
axis.text=element_text(size=15),
strip.text=element_text(size=15),
legend.text=element_text(size=15),
legend.title=element_text(size=15),
legend.key.size=unit(0.5,"cm"),
legend.position = "bottom",
panel.background = element_rect(fill = "white"),
axis.text.x = element_text(angle = 45, hjust = 1)) +
theme_hc() +
scale_color_grey(start=0.9, end=0.1, name="Wave")
figure3
ggsave(here("Output", "Graphs", "Figure3.jpg"), plot=figure3, height = 10, width = 9, units="in")
#Figure 3: Preference for redistribution by country and year
figure3 = ggplot(lapop, aes(x= redistribution,  colour= year)) +
geom_line(aes(y = ..prop.., fill = factor(..x..)), stat="count", binwidth = 1, size = 1) +
xlim(1, 7) +
facet_wrap(~countryname, ncol=3) +
labs(x = "Preference for redistribution", y = "", fill="") +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_x_continuous(breaks = c(1:7), labels = c("1 (Disagree)", "2", "3", "4", "5", "6", "7 (Agree)")) +
theme(
axis.text=element_text(size=15),
strip.text=element_text(size=15),
legend.text=element_text(size=15),
legend.title=element_text(size=15),
legend.key.size=unit(0.5,"cm"),
legend.position = "bottom",
panel.background = element_rect(fill = "white"),
axis.text.x = element_text(angle = 45, hjust = 1, size = 1)) +
theme_hc() +
scale_color_grey(start=0.9, end=0.1, name="Wave")
figure3
ggsave(here("Output", "Graphs", "Figure3.jpg"), plot=figure3, height = 10, width = 9, units="in")
#Figure 3: Preference for redistribution by country and year
figure3 = ggplot(lapop, aes(x= redistribution,  colour= year)) +
geom_line(aes(y = ..prop.., fill = factor(..x..)), stat="count", binwidth = 1, size = 1) +
xlim(1, 7) +
facet_wrap(~countryname, ncol=3) +
labs(x = "Preference for redistribution", y = "", fill="") +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_x_continuous(breaks = c(1:7), labels = c("1 (Disagree)", "2", "3", "4", "5", "6", "7 (Agree)")) +
theme(
axis.text=element_text(size=15),
strip.text=element_text(size=15),
legend.text=element_text(size=15),
legend.title=element_text(size=15),
legend.key.size=unit(0.5,"cm"),
legend.position = "bottom",
panel.background = element_rect(fill = "white"),
axis.text.x = element_text(angle = 45, hjust = 1, size = 5)) +
theme_hc() +
scale_color_grey(start=0.9, end=0.1, name="Wave")
figure3
#Figure 3: Preference for redistribution by country and year
figure3 = ggplot(lapop, aes(x= redistribution,  colour= year)) +
geom_line(aes(y = ..prop.., fill = factor(..x..)), stat="count", binwidth = 1, size = 1) +
xlim(1, 7) +
facet_wrap(~countryname, ncol=3) +
labs(x = "Preference for redistribution", y = "", fill="") +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_x_continuous(breaks = c(1:7), labels = c("1 (Disagree)", "2", "3", "4", "5", "6", "7 (Agree)")) +
theme(
axis.text=element_text(size=15),
strip.text=element_text(size=15),
legend.text=element_text(size=15),
legend.title=element_text(size=15),
legend.key.size=unit(0.5,"cm"),
legend.position = "bottom",
panel.background = element_rect(fill = "white"),
axis.text.x = element_text(angle = 45, hjust = 1, size = 10)) +
theme_hc() +
scale_color_grey(start=0.9, end=0.1, name="Wave")
figure3
ggsave(here("Output", "Graphs", "Figure3.jpg"), plot=figure3, height = 10, width = 9, units="in")
#Figure 3: Preference for redistribution by country and year
figure3 = ggplot(lapop, aes(x= redistribution,  colour= year)) +
geom_line(aes(y = ..prop.., fill = factor(..x..)), stat="count", binwidth = 1, size = 1) +
xlim(1, 7) +
facet_wrap(~countryname, ncol=3) +
labs(x = "Preference for redistribution", y = "", fill="") +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_x_continuous(breaks = c(1:7), labels = c("1 (Disagree)", "2", "3", "4", "5", "6", "7 (Agree)")) +
theme(
axis.text=element_text(size=15),
strip.text=element_text(size=15),
legend.text=element_text(size=15),
legend.title=element_text(size=15),
legend.key.size=unit(0.5,"cm"),
legend.position = "bottom",
panel.background = element_rect(fill = "white"),
axis.text.x = element_text(angle = 90, hjust = 1, size = 10)) +
theme_hc() +
scale_color_grey(start=0.9, end=0.1, name="Wave")
figure3
ggsave(here("Output", "Graphs", "Figure3.jpg"), plot=figure3, height = 10, width = 9, units="in")
#Install and load packages
pacman::p_load(tidyverse, lme4, stats, texreg, car, interplot, sjPlot,
data.table, influence.ME, performance, ggeffects, pals, data.table,
janitor, xtable, matrixStats, scales, ggthemes, here, conflicted)
#Packages conflicts
conflict_prefer("select", "dplyr")
conflict_prefer("filter", "dplyr")
conflict_prefer("recode", "car")
conflict_prefer("melt", "data.table")
#Load database
rm(list = ls())
load(here("Input", "Proc", "LAPOP_Final.RData"))
#Rename variables
lapop = lapop %>%
mutate(Redistribution = redistribution,
Income = decile,
Male = male_f,
Age = age,
Political = ideology_f,
Left = left,
Married = married_f,
SystemConfidence=sysconf,
Employment=employment_r,
Education=education_r,
Urban=zone,
Income_Decile=decile_f,
GINI=gini,
GDP=gdp,
GINI_Mean=gini_mean,
GINI_Diff=gini_dif,
GDP_Mean=gdp_mean,
GDP_Diff=gdp_dif,
Welfare = welfare,
Country = countryname,
CountryWave = country_wave,
Year = year,
Decile_d10 = decile_d10,
Decile_d1 = decile_d1,
Income2 = Income*Income)
#Null model: Country Year (with Venezuela)
model_0_ven = lmer(redistribution ~ 1 + (1 | country_wave) + (1 | countryname), data=lapop_all, weights=wt)
screenreg(model_0_ven, stars = c(0.01,0.05,0.1))
?screenreg
??screenreg
#Install and load packages
pacman::p_load(tidyverse, lme4, stats, texreg, car, interplot, sjPlot,
data.table, influence.ME, performance, ggeffects, pals, data.table,
janitor, xtable, matrixStats, scales, ggthemes, here, conflicted)
